# 構築する構成図
<img width="690" alt="スクリーンショット 2024-12-30 8 37 52" src="https://github.com/user-attachments/assets/3f46dd89-47cc-4587-91c8-7e4f7a34a2af" />

# 構成図説明
## VPC、サブネットの関係
 - 本ソフトウェアサービスを構築するにあたってVPCを利用し、リージョン自体は東京リージョンで設定されている。またサブネットをPublicとPrivateで分けており、DBのようにサービス外から直接アクセスできないようにしたいものはPrivate、サービスはインターネットとの接続を可能にしたいため、Publicになっている。（セキュリティグループやACLの設定などは構成図には記述されていないが、）
## ECSとECRの関係
 - ECSはフルマネージドのコンテナサービスであり、Dockerのコンテナ管理を実行できる。ただし、この構成図では、ECRでgithubにある開発ないしは本番ようのブランチを紐づけてイメージを作成しており、それをECS上に持ってきて実行・稼働させている。
## Aurora MySQLのWriterとReaderについて
 - Aurora MySQLには、Writer用とReader用のインスタンスがある。これは、それぞれのインスタンスに役割を明確にさせ、処理の負荷分散（詳しくはALBで説明）を明示的にもしている。
## CloudFrontとS3
 - CloudFrontでは、CDNであり、適切なエッジロケーションを利用して高速かつ安全に配信をしてくれる。また、S3を使用することで性的コンテンツをS3に入れておき、高速で配信をし、CloudFrontでキャッシュして、S3へのアクセス数も減らす。これらにより、VPC内の動的コンテンツ以外はより、高速かつ効率よく配信ができる。
## Route 53
 - DNSを作成するサービスであり、ユーザが本アプリケーションを呼び出すためのドメイン名からIPアドレスに変換し、ルーティングの最適化を行うために使用している。また、ヘルスチェック機能もあるため、CloudWtach系のサービスでアラートやログを出すこともできる。
## ACM
 - CloudFrontで最適かつ安全に配信するためにhttpなどよりもhttpsを有効にしたい。そこでACMを使用して証明書を発行し、httpsでのアクセスを有効にする。まとめるとRoute 53でドメイン名を作成し、CloudFrontで安全に配信するためにACMを発行する。
## IGW （インターネットゲートウェイ）からALB
 - CloudFront（CDN）で配信できるようになり、インターネットゲートウェイを通して実装しているプロダクトを実際に配信する。そこでECSやPrvateサブネットのAurora MySQLの負荷分散をする。アクセス数が急激に増えた場合に一つのインスタンスに集中して環境が壊れたりしないようにアクセスを分散させるためにALBを介して接続している。
## CloudWatch MetricsとCloudWatach Logs
 - CloundWatch Metricsでは、サービスのアクセス数や負荷のしきい値を設定しそれを超えたらアラームがされるように設定し、可視化された状態で環境をwatchできる。また、細かいエラーログなどをLogsの方で吐き出し、対処をできるようにしている。

# outputでのメモ
## ドメインとサブドメイン
 - ドメインはそのビジネスを代表する識別子であり、サブドメインはサービスやリソースの分割のために特定する。
## NSレコードの設定→権限か何かが必要？
 - まずNSレコードは特定のドメインのDNS情報を管理するネームサーバーを指定するためのDNSレコードであり、権限を付与することでインターネット上に反映される。方法としては、ドメインレジストラでネームサーバーをRoute 53のNSコードに置き換える。
 - また、アクセスには適切なIAMポリシーを設定して変更を制限する。
## レコード内容はそれぞれどういう意味があるのか
 - NSレコード：DNS情報を管理するためのDNSレコードであり、セキュリティなどの保持など
 - Aレコード：ドメイン名をIPv4アドレス（IPアドレス）に変換するためのレコード
 - CNAMEレコード：ドメインの管理者が誰なのかを証明するためのレコード
## リスナーとターゲットグループなどの関係性
 - リスナーがトラフィックを受信し、ターゲットグループに転送（POSSE課題ではターゲットグループの作成でインスタンスを作成しているため、ALBの作成でレスポンスを返せるようになっていた）
## なぜ再度レスポンスを更新したのか
 - デフォルトが503なのがよくないからか
